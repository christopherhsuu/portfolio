    <!-- Only keep the unified project container version below -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pitch Sequences — Christopher Hsu</title>
    <link href="../styles.css" rel="stylesheet">
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <div class="brand">
          <a href="/" class="site-title">Christopher Hsu</a>
          <p class="tagline">Data Science &amp; Sabermetrics</p>
        </div>
        <nav aria-label="Main navigation">
          <ul class="nav-list">
            <li><a href="/">Home</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </nav>
      </div>
    </header>

  <main class="section page-inner" style="max-width:1400px; margin:32px auto 0 auto; background:#16161a; border-radius:18px; box-shadow:0 4px 32px 0 rgba(0,0,0,0.12);">
    <div class="project-container">
      <div style="margin-top:20px; display:flex; gap:12px; align-items:center;">
        <a class="launch-big" href="https://pitchsequence.streamlit.app/" target="_blank" rel="noopener noreferrer">Launch (Live)</a>
        <a class="btn ghost" href="https://github.com/christopherhsuu/pitchsequence/tree/main" target="_blank" rel="noopener noreferrer">Code</a>
      </div>
      <h1>Pitch Sequences</h1>
      <p class="muted">An interactive visualization of pitch sequences, pitch types, and swing outcomes. The app helps explore sequencing patterns and batter responses by zone and count.</p>
      <section class="prose max-w-4xl text-gray-200 mt-8 space-y-6">
        <h2 class="font-bold text-2xl mt-8 mb-2">Methodology &amp; Execution</h2>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">Overview</h3>
        <p style="line-height:1.25em;">
          <strong>PitchSequence</strong> is a sabermetric machine-learning pipeline and interactive <strong>Streamlit</strong> app that recommends the next pitch a pitcher should throw in a given situation. It blends <strong>Statcast</strong> data, batter archetypes, pitcher arsenals, and a run-value prediction model to simulate how decisions impact expected runs.
        </p>
        <p style="line-height:1.25em;">
          The system integrates data processing, feature engineering, model training, and UI design to create an explainable recommender that mirrors real-world pitch-calling logic.
        </p>

        <h3 class="font-bold text-xl mt-6 mb-2">1. Data Preparation</h3>
        <h4 class="font-semibold text-lg mt-4 mb-2">Directories &amp; inputs</h4>
        <table class="min-w-full text-sm border border-gray-700 mb-4">
          <thead>
            <tr class="bg-gray-800">
              <th class="px-4 py-2 text-left font-semibold">Folder</th>
              <th class="px-4 py-2 text-left font-semibold">Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>data/raw/</code></td>
              <td class="px-4 py-2">Raw Statcast dumps (statcast_2025.csv, name mapping files)</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>data/processed/</code></td>
              <td class="px-4 py-2">Cleaned and feature-engineered Parquet files (cleaned.parquet, features.parquet, runvalue.parquet)</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>pitcher_assets/pitcher_arsenals.csv</code></td>
              <td class="px-4 py-2">Inferred pitcher arsenals derived from Statcast</td>
            </tr>
          </tbody>
        </table>
        <ul class="list-disc ml-6 space-y-2">
          <li>Data ingestion begins by placing raw CSVs in <code>data/raw/</code> and running <code>src/preprocess.py</code>, which:
            <ul class="list-disc ml-6 space-y-1">
              <li>Parses timestamps and cleans inconsistent or missing rows.</li>
              <li>Normalizes pitch type labels (FF, SL, CH, etc.).</li>
              <li>Ensures batter and pitcher names align across datasets.</li>
              <li>Drops invalid rows lacking pitch type or outcome information.</li>
            </ul>
          </li>
          <li>Next, <code>src/feature_engineering.py</code> computes play-level and aggregate features:
            <ul class="list-disc ml-6 space-y-1">
              <li>Maps categorical pitch locations (“Top-In”, “Low-Away”) to numeric plate coordinates (<code>plate_x</code>, <code>plate_z</code>).</li>
              <li>Calculates <code>last_pitch_speed_delta</code> and contextual deltas.</li>
              <li>Aggregates batter vs. pitch_type statistics such as:
                <ul class="list-disc ml-6 space-y-1">
                  <li><code>batter_pitchtype_woba</code></li>
                  <li><code>batter_pitchtype_whiff_rate</code></li>
                  <li><code>batter_pitchtype_run_value</code></li>
                </ul>
              </li>
            </ul>
          </li>
          <li>Data cleaning &amp; filtering:
            <ul class="list-disc ml-6 space-y-1">
              <li>Missing numeric values are imputed with contextual defaults (e.g., 0 for missing rates).</li>
              <li>Unrealistic outliers (e.g., release speeds &gt;105 mph) are winsorized.</li>
              <li>Pitchers/batters with insufficient sample sizes are filtered out to stabilize estimates.</li>
              <li>Only recent seasons (1–3 years) are used for modeling to avoid historical drift.</li>
              <li>All processed outputs are saved to <code>data/processed/</code> for efficient re-use during model training.</li>
            </ul>
          </li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">2. Feature Engineering</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li><strong>Core features:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Count &amp; base state: <code>balls</code>, <code>strikes</code>, <code>outs_when_up</code>, <code>on_1b</code>, <code>on_2b</code>, <code>on_3b</code></li>
              <li>Pitch data: <code>pitch_type</code>, <code>release_speed</code>, <code>release_spin_rate</code></li>
              <li>Plate location: <code>plate_x</code>, <code>plate_z</code>, <code>zone</code></li>
              <li>Temporal context: <code>last_pitch_type</code>, <code>last_pitch_result</code>, <code>last_pitch_speed_delta</code></li>
              <li>Batter matchup metrics: <code>batter_pitchtype_woba</code>, <code>batter_pitchtype_whiff_rate</code>, <code>batter_pitchtype_run_value</code></li>
            </ul>
          </li>
          <li><strong>Transformations:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Categorical features are one-hot or target-encoded in the model pipeline.</li>
              <li>Numeric variables are scaled as needed.</li>
              <li>Interaction terms such as <code>count × pitch_type</code> capture strategic context.</li>
            </ul>
          </li>
          <li><strong>Rationale:</strong>
            <p style="line-height:1.25em;">The feature space merges physical characteristics (pitch speed, location) with situational and matchup information, enabling the model to predict not just what is thrown, but what should be thrown to minimize run expectancy.</p>
          </li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">3. Model Training</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>The training logic resides in <code>src/model_train.py</code>, producing a serialized artifact at <code>artifacts/runvalue_model.pkl</code>.</li>
          <li><strong>Pipeline steps:</strong>
            <ol class="list-decimal ml-6 space-y-1">
              <li>Load preprocessed data from <code>data/processed/features.parquet</code> and run-value targets from <code>runvalue.parquet</code>.</li>
              <li>Split data into train/validation/test sets using a time-based split to prevent data leakage.</li>
              <li>Construct a scikit-learn pipeline for:
                <ul class="list-disc ml-6 space-y-1">
                  <li>Categorical encoding</li>
                  <li>Missing-value imputation</li>
                  <li>Scaling</li>
                  <li>Regression model training</li>
                </ul>
              </li>
              <li>Train candidate regressors such as:
                <ul class="list-disc ml-6 space-y-1">
                  <li><code>RandomForestRegressor</code></li>
                  <li><code>GradientBoostingRegressor</code></li>
                </ul>
              </li>
              <li>Optimize hyperparameters via grid or randomized search.</li>
              <li>Evaluate with <code>MSE</code>, <code>MAE</code>, and explained variance, selecting the model with the lowest error on validation data.</li>
              <li>Save the fitted model using <code>joblib.dump()</code> or <code>pickle</code> for deployment.</li>
            </ol>
          </li>
          <li><strong>Notes:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Version alignment for scikit-learn is crucial to avoid unpickling errors.</li>
              <li>For long-term maintenance, pin dependencies in <code>requirements.txt</code>.</li>
            </ul>
          </li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">4. Evaluation</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Evaluation focuses on both numerical accuracy and strategic validity:</li>
          <li><strong>Metrics:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Mean Squared Error (<code>MSE</code>)</li>
              <li>Mean Absolute Error (<code>MAE</code>)</li>
              <li>Explained Variance</li>
            </ul>
          </li>
          <li><strong>Decision-support quality:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Tests whether the model’s ranked pitch recommendations correlate with lower realized run values.</li>
            </ul>
          </li>
          <li><strong>Diagnostics:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Residual plots</li>
              <li>Feature importance charts</li>
              <li>Partial dependence plots</li>
            </ul>
          </li>
          <li>A time-aware cross-validation (sliding-window approach) ensures robustness against season-to-season variation.</li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">5. Deployment &amp; UI</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Deployment centers on <code>app.py</code>, a Streamlit interface that orchestrates the at-bat simulation.</li>
        </ul>
        <h4 class="font-semibold text-lg mt-4 mb-2">Runtime flow</h4>
        <ol class="list-decimal ml-6 space-y-1">
          <li>Load the trained model (<code>artifacts/runvalue_model.pkl</code>).</li>
          <li>Initialize batter and pitcher data via name inputs only — no IDs required.</li>
          <li>For a given count and base-state, compute candidate pitches and convert run-value predictions into softmax probabilities, favoring pitches that minimize expected runs:</li>
        </ol>
        <pre class="bg-gray-900 text-gray-100 p-4 rounded mb-4"><code>expected_after_RE = current_RE + predicted_run_value</code></pre>
        <ol class="list-decimal ml-6 space-y-1" start="4">
          <li>Display ranked pitch recommendations with associated probabilities and strike-zone visuals.</li>
          <li>Record pitch outcome → update count and base-state → recompute recommendations.</li>
        </ol>
        <p style="line-height:1.25em;">This stepwise loop allows users to walk through a realistic at-bat.</p>
        <h4 class="font-semibold text-lg mt-4 mb-2">Deployment Notes</h4>
        <ul class="list-disc ml-6 space-y-1">
          <li>On Streamlit Cloud, set the main module to <code>app/app.py</code> (wrapper imports root <code>app.py</code>).</li>
          <li>Large artifacts should be hosted externally or with Git LFS.</li>
          <li>To eliminate <code>InconsistentVersionWarning</code>, re-export models with the target environment’s library versions.</li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">7. File Map</h3>
        <table class="min-w-full text-sm border border-gray-700 mb-4">
          <thead>
            <tr class="bg-gray-800">
              <th class="px-4 py-2 text-left font-semibold">File</th>
              <th class="px-4 py-2 text-left font-semibold">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>app.py</code></td>
              <td class="px-4 py-2">Main Streamlit UI managing at-bat flow and model integration</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>app/app.py</code></td>
              <td class="px-4 py-2">Hosting wrapper (imports root app)</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>src/preprocess.py</code></td>
              <td class="px-4 py-2">Cleans and normalizes raw Statcast data</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>src/feature_engineering.py</code></td>
              <td class="px-4 py-2">Generates per-play features and batter aggregates</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>src/model_train.py</code></td>
              <td class="px-4 py-2">Model training and artifact creation</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>src/predict.py</code></td>
              <td class="px-4 py-2">Loads model and produces run-value predictions</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>src/attack_recommender.py</code></td>
              <td class="px-4 py-2">Heuristic fallback and matchup helpers</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>src/build_pitcher_arsenals.py</code></td>
              <td class="px-4 py-2">Infers arsenals and writes pitcher_arsenals.csv</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>data/raw/</code></td>
              <td class="px-4 py-2">Raw Statcast CSVs and mapping files</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>data/processed/</code></td>
              <td class="px-4 py-2">Parquet outputs for model input</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>artifacts/runvalue_model.pkl</code></td>
              <td class="px-4 py-2">Trained pipeline used in production</td>
            </tr>
          </tbody>
        </table>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">8. Future Enhancements</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Integrate additional batter-level Statcast metrics (chase rate, contact rate).</li>
          <li>Implement stacked or ensemble models for improved predictive performance.</li>
          <li>Add sequence-level visualization dashboards for post-at-bat analysis.</li>
          <li>Enable authenticated sessions to log and replay saved at-bats.</li>
          <li>Support online retraining to reflect in-season player trends.</li>
        </ul>
      </section>
      <section class="prose max-w-4xl text-gray-200 mt-8 space-y-6">
        <h2 class="font-bold text-2xl mt-8 mb-2">Methodology &amp; Execution</h2>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">Overview</h3>
        <p style="line-height:1.25em;">
          <strong>Hitter Archetypes</strong> is a sabermetric clustering pipeline and interactive <strong>Streamlit</strong> app designed to identify, classify, and visualize MLB hitter archetypes using aggregated Statcast and tracking data.
        </p>
        <p style="line-height:1.25em;">
          By combining swing mechanics, contact quality, and tracking-based features, the system groups hitters into data-driven archetypes (e.g., High-Launch Sluggers, Compact-Contact Hitters) using <strong>PCA</strong> for dimensionality reduction and <strong>KMeans</strong> for clustering. The final Streamlit interface enables interactive exploration of these groups—showing cluster centroids, representative players, and detailed diagnostics.
        </p>

        <h3 class="font-bold text-xl mt-6 mb-2">1. Data Preparation</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>All preprocessing occurs through the <code>scripts/</code> directory, supported by exploratory notebooks under <code>notebooks/</code>.</li>
        </ul>
        <h4 class="font-semibold text-lg mt-4 mb-2">Data sources</h4>
        <ul class="list-disc ml-6 space-y-1">
          <li>Raw Statcast, pitch-level, and swing-level CSVs stored in <code>data/raw/</code>.</li>
          <li>Name-mapping CSVs linking numeric player IDs to display names.</li>
        </ul>
        <h4 class="font-semibold text-lg mt-4 mb-2">Scripts used</h4>
        <ul class="list-disc ml-6 space-y-1">
          <li><code>scripts/cluster_archetypes.py</code> — main preprocessing and clustering script.</li>
          <li><code>scripts/add_player_names.py</code> — enriches player IDs with readable names.</li>
        </ul>
        <h4 class="font-semibold text-lg mt-4 mb-2">Workflow</h4>
        <ol class="list-decimal ml-6 space-y-1">
          <li><strong>Raw extraction:</strong> Pull data via Statcast queries or custom scripts (examples in <code>notebooks/get_savant_data.ipynb</code>).</li>
          <li><strong>Aggregation:</strong> Compute per-player feature aggregates such as:
            <ul class="list-disc ml-6 space-y-1">
              <li><code>launch_speed_mean</code>, <code>launch_angle_mean</code></li>
              <li><code>bat_speed_mean</code>, <code>pct_hard_hit</code></li>
              <li><code>swing_length_mean</code></li>
              <li><code>intercept_ball_minus_batter_pos_x_inches_mean</code></li>
              <li><code>n_swings</code></li>
            </ul>
            Aggregations include mean, standard deviation, median, and 95th-percentile metrics to capture consistency and upper-end performance.
          </li>
          <li><strong>Missing values and outliers:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Missing counts are replaced with 0 or ignored where complete data is required.</li>
              <li>Numeric features are winsorized at the 1st and 99th percentiles to mitigate the impact of extreme values before PCA.</li>
            </ul>
          </li>
          <li><strong>Circular features:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Angular stats like <code>attack_direction_mean</code> and <code>launch_angle_mean</code> are decomposed into sine and cosine components to avoid wrap-around discontinuities in distance computations.</li>
            </ul>
          </li>
          <li><strong>Name mapping:</strong> If available, <code>data/raw/unique_batters_with_names.csv</code> enriches numeric IDs into <code>name</code> or <code>name_display</code>. The app gracefully falls back to numeric IDs if mappings are absent.</li>
          <li><strong>Exports:</strong> Final aggregated data written to <code>data/player_archetypes.csv</code>, with per-cluster breakdowns exported later to <code>data/clusters/</code>.</li>
        </ol>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">2. Feature Engineering</h3>
        <table class="min-w-full text-sm border border-gray-700 mb-4">
          <thead>
            <tr class="bg-gray-800">
              <th class="px-4 py-2 text-left font-semibold">Category</th>
              <th class="px-4 py-2 text-left font-semibold">Example Features</th>
              <th class="px-4 py-2 text-left font-semibold">Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-gray-900">
              <td class="px-4 py-2">Power &amp; Contact</td>
              <td class="px-4 py-2"><code>launch_speed_mean</code>, <code>pct_hard_hit</code></td>
              <td class="px-4 py-2">Quantify exit velocity and contact strength</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2">Swing Mechanics</td>
              <td class="px-4 py-2"><code>bat_speed_mean</code>, <code>swing_length_mean</code>, <code>swing_path_tilt_mean</code></td>
              <td class="px-4 py-2">Capture bat speed and swing geometry</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2">Timing &amp; Intercept</td>
              <td class="px-4 py-2"><code>intercept_ball_minus_batter_pos_x_inches_mean</code>, <code>intercept_ball_minus_batter_pos_y_inches_mean</code></td>
              <td class="px-4 py-2">Model timing offset and impact zone alignment</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2">Angles</td>
              <td class="px-4 py-2"><code>launch_angle_mean</code>, <code>attack_angle_mean</code>, <code>attack_direction_mean</code></td>
              <td class="px-4 py-2">Capture directional tendencies (converted to sin/cos)</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2">Sample Size</td>
              <td class="px-4 py-2"><code>n_swings</code></td>
              <td class="px-4 py-2">Used for filtering and log transforms</td>
            </tr>
          </tbody>
        </table>
        <ul class="list-disc ml-6 space-y-2">
          <li><strong>Transformations:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Create <code>_sin</code> and <code>_cos</code> columns for all angular metrics.</li>
              <li>Apply <code>log1p</code> to count-like variables (<code>n_swings</code>).</li>
              <li>Winsorize all numeric columns at [0.01, 0.99] quantiles.</li>
              <li>Scale features using <code>RobustScaler</code> for outlier-resistant normalization.</li>
            </ul>
          </li>
          <li><strong>Rationale:</strong>
            <p style="line-height:1.25em;">This combination of geometric, mechanical, and contextual variables ensures that clusters capture how players produce results, not just what results they produce.<br>By encoding angles circularly and scaling robustly, the model remains stable even with noisy Statcast inputs.</p>
          </li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">3. Clustering Pipeline</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Implemented in <code>scripts/cluster_archetypes.py</code>.</li>
        </ul>
        <h4 class="font-semibold text-lg mt-4 mb-2">Step-by-step process</h4>
        <ol class="list-decimal ml-6 space-y-1">
          <li>Select feature subset (defaults to all numeric or diagnostic-recommended columns).</li>
          <li>Expand angle columns into sine/cosine pairs.</li>
          <li>Apply log, winsorization, and scaling transformations.</li>
          <li>Perform <code>PCA</code> (2 components) for dimensional visualization.</li>
          <li>Run <code>KMeans</code> with an experimentally chosen k (e.g., 5).</li>
          <li>Save cluster assignments to <code>data/player_archetypes.csv</code>.</li>
          <li>Export per-cluster CSVs to <code>data/clusters/</code>.</li>
        </ol>
        <h4 class="font-semibold text-lg mt-4 mb-2">Reproducibility</h4>
        <ul class="list-disc ml-6 space-y-1">
          <li>Set <code>random_state</code> in <code>KMeans</code> for deterministic clusters.</li>
          <li>Persist preprocessing scalers and PCA metadata for consistent future predictions.</li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">4. Evaluation &amp; Diagnostics</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Because clustering is unsupervised, evaluation relies on interpretability and visual coherence rather than prediction accuracy.</li>
          <li><strong>Diagnostics used:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Centroid heatmaps — visualize feature z-scores by cluster to show distinguishing traits.</li>
              <li>Representative players — nearest neighbors to each centroid define real-world exemplars for labeling.</li>
              <li>PCA scatter plots — project 2D embeddings to assess separation.</li>
              <li>Metrics: silhouette score and Davies–Bouldin index for quantitative validation.</li>
            </ul>
          </li>
          <li><strong>Interpretation workflow:</strong>
            <ul class="list-disc ml-6 space-y-1">
              <li>Compute z-scored centroids.</li>
              <li>Plot heatmaps to highlight outlier features per group.</li>
              <li>Inspect top representative players to assign intuitive labels like “Line-Drive Contact” or “Pull-Power Barrelers.”</li>
            </ul>
          </li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">6. Project File Map</h3>
        <table class="min-w-full text-sm border border-gray-700 mb-4">
          <thead>
            <tr class="bg-gray-800">
              <th class="px-4 py-2 text-left font-semibold">File / Directory</th>
              <th class="px-4 py-2 text-left font-semibold">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>app.py</code></td>
              <td class="px-4 py-2">Streamlit UI: plotting, cluster summaries, player search</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>data/player_archetypes.csv</code></td>
              <td class="px-4 py-2">Main per-player dataset used by app</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>data/raw/unique_batters_with_names.csv</code></td>
              <td class="px-4 py-2">Optional ID → name mapping</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>data/clusters/*</code></td>
              <td class="px-4 py-2">Per-cluster exports and summaries</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>scripts/cluster_archetypes.py</code></td>
              <td class="px-4 py-2">Clustering pipeline and preprocessing logic</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>scripts/add_player_names.py</code></td>
              <td class="px-4 py-2">Name-enrichment utility</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>notebooks/</code></td>
              <td class="px-4 py-2">Exploratory data notebooks</td>
            </tr>
            <tr class="bg-gray-800">
              <td class="px-4 py-2"><code>utils/</code></td>
              <td class="px-4 py-2">Helper modules for UI and plotting</td>
            </tr>
            <tr class="bg-gray-900">
              <td class="px-4 py-2"><code>requirements.txt, requirements-streamlit.txt</code></td>
              <td class="px-4 py-2">Dependency manifests</td>
            </tr>
          </tbody>
        </table>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">7. Future Directions</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Add supervised prediction tasks (next-season wOBA, HR%, discipline metrics).</li>
          <li>Introduce zone-specific and temporal features for finer clustering.</li>
          <li>Deploy a hosted dashboard with backend API for new player assignments.</li>
          <li>Implement unit tests for preprocessing consistency (winsorization, circular transforms).</li>
        </ul>
        <hr class="my-4 border-gray-700">

        <h3 class="font-bold text-xl mt-6 mb-2">8. Design Notes</h3>
        <ul class="list-disc ml-6 space-y-2">
          <li>Circular variables are expanded before PCA to prevent discontinuities.</li>
          <li>Random seeds ensure deterministic clustering.</li>
          <li>Per-cluster exports facilitate future supervised model training or archetype tracking.</li>
          <li>Streamlit UI modularization (with <code>utils/</code> helpers) keeps the front-end maintainable.</li>
        </ul>
      </section>

      <div style="margin-top:20px; display:flex; gap:12px; align-items:center;">
        <a class="launch-big" href="https://pitchsequence.streamlit.app/" target="_blank" rel="noopener noreferrer">Launch (Live)</a>
        <a class="btn ghost" href="https://github.com/christopherhsuu/pitchsequence/tree/main" target="_blank" rel="noopener noreferrer">Code</a>
      </div>

      <section style="margin-top:28px;">
        <h2>Purpose</h2>
        <p class="muted">PitchSequence recommends next-pitch candidates for a pitcher-vs-batter matchup by estimating expected run impact at the play level. It merges model-driven scores with batter-specific matchup aggregates to produce actionable candidate rankings.</p>

        <h2>Quick start</h2>
        <ol>
          <li>Clone the repo, create a Python 3.13 virtualenv, and install dependencies.</li>
          <li>Run preprocessing and feature engineering to create `data/processed/*.parquet` (see scripts).</li>
          <li>Train or load a saved `artifacts/runvalue_model.pkl`, then open the Streamlit app to try the stepwise at-bat UI.</li>
        </ol>

        <h2>Data preparation (what I did)</h2>
        <ol>
          <li>Stored raw Statcast CSVs and name mapping files in <code>data/raw/</code>.</li>
          <li>Ran <code>src/preprocess.py</code> to clean, standardize, and normalize pitch data.</li>
          <li>Generated per-play features and batter-pitchtype aggregates with <code>src/feature_engineering.py</code>; saved outputs as Parquet files.</li>
          <li>Applied exposure filters and winsorization for robust aggregate statistics.</li>
        </ol>

        <h2>Feature engineering (what I built)</h2>
        <ol>
          <li>Extracted plate_x/plate_z coordinates, last-pitch deltas, and assigned zone buckets.</li>
          <li>Computed batter-pitchtype aggregates (wOBA, whiff rate, run value) from processed data.</li>
          <li>Encoded categorical features and formatted inputs for the run-value modeling pipeline.</li>
        </ol>

        <h2>Modeling &amp; training</h2>
        <ol>
          <li>Loaded `data/processed/features.parquet` and `data/processed/runvalue.parquet`.</li>
          <li>Built a scikit-learn pipeline for encoding, imputation, scaling, and the estimator (GradientBoosting or RandomForest).</li>
          <li>Used time-aware train/validation/test splits to avoid leakage and tuned hyperparameters via grid/random search.</li>
          <li>Saved the final pipeline to `artifacts/runvalue_model.pkl` for use in the app or server endpoints.</li>
        </ol>

        <h2>Deployment &amp; usage</h2>
        <p class="muted">The Streamlit app loads the saved pipeline and scores candidate pitches for a given state. Predictions are converted into candidate probabilities by adding predicted run-value to the current run expectancy and applying a softmax over negative expected runs. The repo also includes a Vercel serverless endpoint that returns recommendations as JSON for programmatic use.</p>

        <h2>Challenges &amp; next steps</h2>
        <p class="muted">Name normalization, sparse batter-pitchtype exposures, and ensuring robust recommendations are primary challenges. The repo mitigates these with name-mapping, minimum exposure thresholds, and blending heuristics. Future work: richer batter features, ensemble stacking, periodic retraining, and a dashboard for evaluation of recommended sequences on holdout data.</p>
      </section>
    </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p class="muted">© 2025 Christopher Hsu</p>
      </div>
    </footer>
  </body>
</html>