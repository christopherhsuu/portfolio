<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>StatForecast — Christopher Hsu</title>
  <link href="../styles.css" rel="stylesheet">
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <div class="brand">
          <a href="/" class="site-title">Christopher Hsu</a>
          <p class="tagline">Data Science &amp; Sabermetrics</p>
        </div>
        <nav aria-label="Main navigation">
          <ul class="nav-list">
            <li><a href="/">Home</a></li>
            <li><a href="/index.html#projects">Projects</a></li>
          </ul>
        </nav>
      </div>
    </header>

  <main class="section page-inner" style="max-width:1400px; margin:32px auto 0 auto; background:#16161a; border-radius:18px; box-shadow:0 4px 32px 0 rgba(0,0,0,0.12);">
      <h1>StatForecast</h1>
      <p class="muted">A forecasting tool that uses historical sabermetrics and machine learning to estimate future player performance. This page links to the live app and the code repository.</p>

      <div style="margin-top:20px; display:flex; gap:12px;">
        <a class="launch-big" href="https://statforecast.streamlit.app" target="_blank" rel="noopener noreferrer">Launch (Live)</a>
        <a class="btn ghost" href="https://github.com/christopherhsuu/statforecast" target="_blank" rel="noopener noreferrer">Code</a>
      </div>

git clone https://github.com/christopherhsuu/statforecast
      <section style="margin-top:28px;">
        <h2>Purpose</h2>
        <p class="muted">StatForecast predicts next-season offensive statistics for MLB hitters. The goal is to produce explainable, trajectory-aware forecasts that use multi-year features (lags, rolling means, and deltas) rather than a single-season snapshot.</p>

        <h2>Quick start</h2>
        <ol>
          <li>Clone the repo and install dependencies (see reproducibility section below).</li>
          <li>Place your hitters CSV (Fangraphs-style) in the repo root or point `load_data()` to it.</li>
          <li>Train the model with <code>train_model()</code> or use the provided joblib artifact and open the Streamlit app to inspect forecasts.</li>
        </ol>

        <h2>Data preparation (what I did)</h2>
        <ol>
          <li>Collected a season-by-season hitters CSV with counting and rate stats (PA, HR, AVG, OBP, SLG, wOBA, BB%, K%, etc.).</li>
          <li>Normalized column names (e.g., Player → Name, Year → Season) and converted percent strings to floats.</li>
          <li>Filtered players by plate appearance threshold (default PA ≥ 200) to reduce noisy samples.</li>
          <li>Sorted by Name and Season and validated required columns; missing columns cause a helpful ValueError.</li>
        </ol>

        <h2>Feature engineering (what I built)</h2>
        <ol>
          <li>Created lag features for lags 1..3 for target stats and relevant covariates.</li>
          <li>Computed rolling means (3-season) shifted to exclude the current season.</li>
          <li>Derived delta features (delta1, delta2), average-delta smoothing, and career-change indicators.</li>
          <li>Added age interaction terms (age × avg_delta) to encode age-dependent momentum.</li>
          <li>Handled missing engineered features by dropping training rows but reindexing and zero-filling at prediction time.</li>
        </ol>

        <h2>Modeling &amp; training (what I ran)</h2>
        <ol>
          <li>Assembled X and Y matrices using `_assemble_matrix()` which records the exact `feature_columns` order.</li>
          <li>Used a train/test split (15% test) with `random_state=42` for quick evaluation.</li>
          <li>Trained a `RandomForestRegressor` (n_estimators=200) wrapped for multi-output predictions and computed RMSE as the primary metric.</li>
          <li>Saved the model and metadata via `joblib.dump({'model': model, 'metadata': metadata}, path)` so prediction-time code can reindex safely.</li>
        </ol>

        <h2>Deployment &amp; usage</h2>
        <p class="muted">The `streamlit_app.py` provides a per-player UI: upload or use the provided CSV, ensure a model is available (local or via `MODEL_URL`), pick a player, and view historical plots and next-season projections. Use Git LFS or external hosting for large joblib artifacts; the app can download a model at runtime if `MODEL_URL` is set.</p>

        <h2>Challenges &amp; next steps</h2>
        <p class="muted">Key challenges included noisy single-season signals (addressed with rolling aggregates) and handling rookies/injury return cases. Next steps: cross-validation and hyperparameter search, add Statcast features (exit velocity percentiles, barrel%), and improve uncertainty estimates (quantile forests or conformal methods).</p>
      </section>

      

      <section style="margin-top:18px;">
        <h2>Reproducibility</h2>
        <pre style="background:rgba(255,255,255,0.02); padding:12px; border-radius:8px; color:var(--muted-text);">
# clone the repository
git clone https://github.com/christopherhsuu/statforecast
cd statforecast
# create and activate a virtualenv, then install
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
# run the Streamlit app
streamlit run app.py
        </pre>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p class="muted">© 2025 Christopher Hsu</p>
      </div>
    </footer>
  </body>
</html>
